# STA2002 概率与统计II - Lecture 7: 假设检验II

## 概述
本讲继续假设检验，重点讨论：
- 两个均值之差的检验
- 两个方差之差的检验
- 配对t检验、合并t检验、Welch t检验
- F检验

## 假设检验框架回顾

1. **设定H₀和H₁**，确定显著性水平α
2. **确定检验统计量T**及其H₀下分布，计算观测值t
3. **决策**：
   - p值方法：p值 ≤ α 则拒绝H₀
   - 临界区域方法：t ∈ C (临界区域) 则拒绝H₀
   - 置信区间方法：CI不包含H₀参数则拒绝H₀

## 两个正态均值之差的检验

### 三种情况
两个独立样本：
X₁,...,Xn ~ N(μ_X, σ_X²)
Y₁,...,Ym ~ N(μ_Y, σ_Y²)

1. **合并t检验**: 方差相等 σ_X² = σ_Y² = σ² (未知)
2. **Welch t检验**: 方差不同 σ_X² ≠ σ_Y² (未知)
3. **配对t检验**: 配对样本，相关

### Case 1: 合并t检验

#### 检验统计量
$$T = \frac{\bar{X} - \bar{Y}}{S_p \sqrt{1/n + 1/m}} \sim t(n+m-2)$$

其中合并方差：
$$S_p^2 = \frac{(n-1)S_X^2 + (m-1)S_Y^2}{n+m-2}$$

#### 示例
n=12, $$\bar{x}$$=1076.75, s_X²=29.30
m=12, $$\bar{y}$$=1072.33, s_Y²=26.24
H₀: μ_X = μ_Y vs H₁: μ_X ≠ μ_Y, α=0.10

t = 2.05, t_{0.05}(22)=1.717
p值 = 2 P(T>2.05) = 0.0525 > 0.10
决策：不拒绝H₀ (边际显著)

### Case 2: Welch t检验

#### 检验统计量
$$T = \frac{\bar{X} - \bar{Y}}{\sqrt{S_X^2/n + S_Y^2/m}} \sim t(r)$$

其中 r 为近似自由度：
$$r = \left\lfloor \left( \frac{S_X^2}{n} + \frac{S_Y^2}{m} \right)^2 \bigg/ \left( \frac{1}{n-1}\left(\frac{S_X^2}{n}\right)^2 + \frac{1}{m-1}\left(\frac{S_Y^2}{m}\right)^2 \right) \right\rfloor$$

#### 示例 (续上例)
假设方差不同，r=15, t=2.05, t_{0.05}(15)=2.131
p值 = 2 P(T>2.05) ≈ 2 P(Z>2.05) = 0.0406 < 0.10
决策：拒绝H₀

### Case 3: 配对t检验

#### 配对样本
设 (X₁,Y₁),...,(Xn,Yn) 为n对相关观测
D_i = X_i - Y_i, D₁,...,Dn ~ N(μ_D, σ_D²)

检验 H₀: μ_D = 0 vs H₁: μ_D ≠ 0

#### 检验统计量
$$T = \frac{\bar{D}}{S_D / \sqrt{n}} \sim t(n-1)$$

#### 示例：绳跳减重实验
n=24, $$\bar{d}$$=0.0788, s_D=0.2549
H₀: μ_D=0 vs H₁: μ_D>0, α=0.10

t = 0.0788 / (0.2549/√24) = 1.514
t_{0.10}(23) = 1.319
p值 = P(T>1.514) = 0.0718 < 0.10
决策：拒绝H₀

## 两个正态方差之差的检验

### 背景
两个独立正态总体：
X₁,...,Xn ~ N(μ_X, σ_X²)
Y₁,...,Ym ~ N(μ_Y, σ_Y²)

检验 H₀: σ_X² = σ_Y² vs H₁: σ_X² ≠ σ_Y²

### F检验统计量

#### 推导
$$U = (n-1)S_X^2 / \sigma_X^2 \sim \chi^2(n-1)$$
$$V = (m-1)S_Y^2 / \sigma_Y^2 \sim \chi^2(m-1)$$

H₀下：F = (S_X^2 / S_Y^2) ∼ F(n-1, m-1)

#### 检验统计量
$$F = \frac{S_X^2}{S_Y^2} \sim F(n-1, m-1)$$

#### 决策规则
拒绝域：F ≥ F_{α/2}(n-1,m-1) 或 F ≤ F_{1-α/2}(n-1,m-1)

注：F_{1-α/2}(n-1,m-1) = 1/F_{α/2}(m-1,n-1)

### 检验过程
1. 计算 F = s_X² / s_Y² (通常让分子分母较大)
2. 若 F > 1：p值 = 2 P(F > f) 其中 F ~ F(n-1,m-1)
3. 若 F < 1：p值 = 2 P(F < f) 其中 F ~ F(n-1,m-1)

### 置信区间等价
检验 H₀: σ_X² = σ_Y² 等价于检查 1 是否在
$$\left( \frac{s_Y^2}{s_X^2} F_{1-\alpha/2}(n-1,m-1), \frac{s_Y^2}{s_X^2} F_{\alpha/2}(n-1,m-1) \right)$$
内

## 难点讲解

### 1. 配对检验的优势
配对样本减少了个体间变异的影响，使得检验更敏感。例如，比较药物效果时，同一个人的前后差异比不同人之间的差异更可靠。

### 2. 合并vs Welch t检验的选择
- **合并t检验**: 假设方差相等，检验更精确但假设可能不成立
- **Welch t检验**: 不假设方差相等，更稳健但检验力稍弱

### 3. F检验的单侧性
F检验天生是双侧的，因为F分布只取正值。不能直接用于单侧假设如"σ_X² > σ_Y²"。

### 4. 检验效能比较
一般来说：配对t检验 > 合并t检验 > Welch t检验

### 5. 实际应用考虑
- 方差齐性检验通常先于均值检验进行
- 如果方差不齐，可能需要用Welch检验
- 样本量不等时要特别小心

### 6. p值计算的技巧
对于F检验：
- 总是比较F统计量与1
- 如果F>1，计算右尾概率
- 如果F<1，计算左尾概率
- 最后乘以2得到双侧p值

## 总结表

| 检验类型 | H₀ | H₁ | 统计量 | 分布 | 拒绝域 |
|----------|-----|-----|--------|------|--------|
| 合并t | μ_X=μ_Y | μ_X>μ_Y | T=(¯x-¯y)/(s_p√(1/n+1/m)) | t(n+m-2) | t≥t_α(n+m-2) |
| 合并t | μ_X=μ_Y | μ_X<μ_Y | 同上 | 同上 | t≤-t_α(n+m-2) |
| 合并t | μ_X=μ_Y | μ_X≠μ_Y | 同上 | 同上 | \|t\|≥t_{α/2}(n+m-2) |
| Welch t | μ_X=μ_Y | μ_X≠μ_Y | T=(¯x-¯y)/√(s_X²/n+s_Y²/m) | t(r) | \|t\|≥t_{α/2}(r) |
| 配对t | μ_D=0 | μ_D>0 | T=¯d/(s_D/√n) | t(n-1) | t≥t_α(n-1) |
| 配对t | μ_D=0 | μ_D≠0 | 同上 | 同上 | \|t\|≥t_{α/2}(n-1) |
| F检验 | σ_X²=σ_Y² | σ_X²≠σ_Y² | F=s_X²/s_Y² | F(n-1,m-1) | F≥F_{α/2} 或 F≤F_{1-α/2} |

## 练习题
1. 解释配对t检验的优势
2. 计算两个样本均值差的检验统计量
3. 设计一个方差齐性检验
4. 比较三种t检验的适用条件
5. 计算F检验的p值
