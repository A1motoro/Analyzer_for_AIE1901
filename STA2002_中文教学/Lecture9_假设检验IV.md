# STA2002 概率与统计II - Lecture 9: 假设检验IV

## 概述
本讲讨论：
- 功效函数 (Power Function)
- 样本量确定
- 实际应用案例

## 类型II错误和功效

### 回顾：假设检验错误
H₀ 真 | H₁ 真
- 拒绝H₀：类型I错误 α
- 不拒绝H₀：正确 | 类型II错误 β

### 功效函数 (Power Function)
K(θ) = P(拒绝H₀ | θ)

其中θ是参数空间中的值。

### 功效的解释
- θ ∈ H₀ 时：K(θ) = α (类型I错误概率)
- θ ∈ H₁ 时：K(θ) = 1 - β(θ) (正确拒绝H₀的概率)

## 功效函数示例

### 学生t检验示例
X₁,...,Xn ~ N(μ, 100), H₀: μ ≤ 60 vs H₁: μ > 60
检验形式：拒绝当 $$\bar{X}$$ ≥ 62

### 功效函数推导
$$\bar{X} \sim N(\mu, 100/n = 4)$$
K(μ) = P($$\bar{X}$$ ≥ 62 | μ) = P(Z ≥ (62-μ)/2)
= 1 - Φ((62-μ)/2)

### 数值计算
- μ=60: K(60) = α = 1 - Φ(1) = 0.1587
- μ=65: K(65) = 1 - Φ((62-65)/2) = 1 - Φ(-1.5) = 0.9332

### 解读
- 当真值μ=65时，有93.32%的概率正确拒绝H₀
- β(65) = 1 - 0.9332 = 0.0668

## 影响功效的因素

### 显著性水平 α
α ↑ ⇒ z_α ↓ ⇒ K(μ₁) ↑ ⇒ β ↓
α ↓ ⇒ z_α ↑ ⇒ K(μ₁) ↓ ⇒ β ↑

### 备择值 μ₁
μ₁ 离 μ₀ 越远，功效越高

### 方差 σ²
σ ↑ ⇒ 功效 ↓

### 样本量 n
n ↑ ⇒ 功效 ↑ (因为SE = σ/√n ↓)

## 样本量确定

### 平衡考虑
- 样本量 ↑：成本 ↑
- 样本量 ↓：估计精度 ↓

### 目标：同时控制 α 和 β

#### 示例：控制 α=0.025, β(65)=0.05
检验：$$\bar{X}$$ ≥ c, H₀: μ=60 vs H₁: μ>60

条件：
α = P($$\bar{X}$$ ≥ c | μ=60) = 0.025 ⇒ c = 60 + 1.96×10/√n
β = P($$\bar{X}$$ < c | μ=65) = 0.05 ⇒ c = 65 - 1.645×10/√n

解得：n=52 (向上取整)

### 一般公式
n = [(z_α + z_β) σ / (μ₁ - μ₀)]²

## 比例检验的样本量

### 单比例检验
目标功效1-β，控制α

n ≥ (z_α √[p₀(1-p₀)] + z_β √[p₁(1-p₁)])² / (p₁ - p₀)²

#### 保守估计
当p₁未知时，用p=0.5的最大方差：
n ≥ (z_α + z_β)² / (p₁ - p₀)²

### 示例：泊松分布比例检验
H₀: p=1/2 vs H₁: p=1/4
目标：α=0.05, β=0.1

使用正态近似：
Y ~ Binomial(n,p)
检验统计量近似标准正态

解得 n≈30.4

## 功效函数的计算

### 正态均值检验的一般形式
H₀: μ = μ₀ vs H₁: μ > μ₀

功效函数：
K(μ₁) = Φ((μ₀ - μ₁)√n/(σ) + z_α)

### 双侧检验
K(μ₁) = Φ((μ₀ - μ₁)√n/(σ) - z_{α/2}) + Φ((μ₀ - μ₁)√n/(σ) + z_{α/2})

### 实际应用
- 临床试验：计算检测治疗效果所需样本量
- A/B测试：确定网站改版效果检验的样本量
- 质量控制：确定检测缺陷率变化的样本量

## 难点讲解

### 1. 功效与显著性水平的权衡
功效函数帮助我们理解：
- 检验的"敏感度"
- 样本量、效应大小、方差的影响
- α和β的不可同时最小化

### 2. 功效分析的实际意义
- **高功效检验**: 能检测小的效应
- **低功效检验**: 可能遗漏重要发现
- 统计显著性 ≠ 实际重要性

### 3. 样本量计算的实用考虑
- **效应大小**: (μ₁ - μ₀)/σ，越小需要越大样本量
- **成本效益**: 样本量增加的边际收益递减
- **前期估计**: 方差未知时用试点研究

### 4. 比例检验的特殊性
比例检验的样本量计算更复杂，因为：
- 方差取决于p
- 需要考虑p的可能取值范围
- 极端p值时近似更差

### 5. 多重检验问题
同时进行多个检验时：
- 家庭错误率 (Family-wise error rate)
- Bonferroni校正
- p值调整

### 6. 功效分析在研究设计中的作用
- **事前功效分析**: 研究设计阶段确定样本量
- **事后功效分析**: 解释不显著结果的原因
- **妥协分析**: 平衡成本与科学价值

## 总结表

| 检验类型 | 功效函数 | 样本量公式 |
|----------|----------|------------|
| 单样本均值 | Φ((μ₀-μ₁)√n/σ + z_α) | n = [(z_α + z_β) σ / \|μ₁-μ₀\|]² |
| 双样本均值 | Φ((μ₀-μ₁)√(n/2)/σ + z_α) | n_total = 2[(z_α + z_β) σ / \|μ₁-μ₀\|]² |
| 单比例 | Φ((p₀-p₁)√n/√[p₁(1-p₁)] + z_α) | n = [z_α√p₀(1-p₀) + z_β√p₁(1-p₁)]² / (p₁-p₀)² |
| 双比例 | Φ((p₀-p₁)√(n/2)/√[p(1-p)] + z_α) | n_total = 2[z_α√p₀(1-p₀) + z_β√p₁(1-p₁)]² / (p₁-p₀)² |

## 练习题
1. 计算一个检验的功效函数
2. 确定控制α和β的样本量
3. 解释功效分析的重要性
4. 设计临床试验的样本量计算
5. 比较不同检验类型的样本量需求
